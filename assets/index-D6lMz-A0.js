import{k as je,d as Ne,_ as Pe,e as we,g as ke,f as Ae,r as x,A as Fe,h as Ce,b as R,l as Se,j as c,H as ze,L as q,p as K,m as te,n as F,q as Oe,t as C,B as Ee,v as re}from"./index-C2mn7hxx.js";import{Q as De}from"./QuantityController-nAI2wS-I.js";import{B as Me}from"./Button-C_YtmuGB.js";import"./InputNumber-CUcksjAC.js";var oe=Symbol.for("immer-nothing"),ne=Symbol.for("immer-draftable"),h=Symbol.for("immer-state");function _(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var j=Object.getPrototypeOf;function N(e){return!!e&&!!e[h]}function b(e){var t;return e?le(e)||Array.isArray(e)||!!e[ne]||!!((t=e.constructor)!=null&&t[ne])||D(e)||M(e):!1}var Be=Object.prototype.constructor.toString();function le(e){if(!e||typeof e!="object")return!1;const t=j(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Be}function S(e,t){E(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function E(e){const t=e[h];return t?t.type_:Array.isArray(e)?1:D(e)?2:M(e)?3:0}function G(e,t){return E(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ue(e,t,r){const n=E(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Te(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function D(e){return e instanceof Map}function M(e){return e instanceof Set}function g(e){return e.copy_||e.base_}function H(e,t){if(D(e))return new Map(e);if(M(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=le(e);if(t===!0||t==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(e);delete n[h];let s=Reflect.ownKeys(n);for(let i=0;i<s.length;i++){const o=s[i],u=n[o];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[o]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[o]})}return Object.create(j(e),n)}else{const n=j(e);if(n!==null&&r)return{...e};const s=Object.create(n);return Object.assign(s,e)}}function Z(e,t=!1){return B(e)||N(e)||!b(e)||(E(e)>1&&(e.set=e.add=e.clear=e.delete=$e),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>Z(n,!0))),e}function $e(){_(2)}function B(e){return Object.isFrozen(e)}var Ie={};function v(e){const t=Ie[e];return t||_(0,e),t}var w;function de(){return w}function Re(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function se(e,t){t&&(v("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function U(e){X(e),e.drafts_.forEach(qe),e.drafts_=null}function X(e){e===w&&(w=e.parent_)}function ce(e){return w=Re(w,e)}function qe(e){const t=e[h];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function ie(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[h].modified_&&(U(t),_(4)),b(e)&&(e=z(t,e),t.parent_||O(t,e)),t.patches_&&v("Patches").generateReplacementPatches_(r[h].base_,e,t.patches_,t.inversePatches_)):e=z(t,r,[]),U(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==oe?e:void 0}function z(e,t,r){if(B(t))return t;const n=t[h];if(!n)return S(t,(s,i)=>ae(e,n,t,s,i,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return O(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let i=s,o=!1;n.type_===3&&(i=new Set(s),s.clear(),o=!0),S(i,(u,f)=>ae(e,n,s,u,f,r,o)),O(e,s,!1),r&&e.patches_&&v("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function ae(e,t,r,n,s,i,o){if(N(s)){const u=i&&t&&t.type_!==3&&!G(t.assigned_,n)?i.concat(n):void 0,f=z(e,s,u);if(ue(r,n,f),N(f))e.canAutoFreeze_=!1;else return}else o&&r.add(s);if(b(s)&&!B(s)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;z(e,s),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&O(e,s)}}function O(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Z(t,r)}function Ke(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:de(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,i=V;r&&(s=[n],i=k);const{revoke:o,proxy:u}=Proxy.revocable(s,i);return n.draft_=u,n.revoke_=o,u}var V={get(e,t){if(t===h)return e;const r=g(e);if(!G(r,t))return Le(e,r,t);const n=r[t];return e.finalized_||!b(n)?n:n===L(e.base_,t)?(Q(e),e.copy_[t]=Y(n,e)):n},has(e,t){return t in g(e)},ownKeys(e){return Reflect.ownKeys(g(e))},set(e,t,r){const n=fe(g(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const s=L(g(e),t),i=s==null?void 0:s[h];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Te(r,s)&&(r!==void 0||G(e.base_,t)))return!0;Q(e),J(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return L(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,Q(e),J(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=g(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){_(11)},getPrototypeOf(e){return j(e.base_)},setPrototypeOf(){_(12)}},k={};S(V,(e,t)=>{k[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});k.deleteProperty=function(e,t){return k.set.call(this,e,t,void 0)};k.set=function(e,t,r){return V.set.call(this,e[0],t,r,e[0])};function L(e,t){const r=e[h];return(r?g(r):e)[t]}function Le(e,t,r){var s;const n=fe(t,r);return n?"value"in n?n.value:(s=n.get)==null?void 0:s.call(e.draft_):void 0}function fe(e,t){if(!(t in e))return;let r=j(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=j(r)}}function J(e){e.modified_||(e.modified_=!0,e.parent_&&J(e.parent_))}function Q(e){e.copy_||(e.copy_=H(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Qe=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const i=r;r=t;const o=this;return function(f=i,...p){return o.produce(f,P=>r.call(this,P,...p))}}typeof r!="function"&&_(6),n!==void 0&&typeof n!="function"&&_(7);let s;if(b(t)){const i=ce(this),o=Y(t,void 0);let u=!0;try{s=r(o),u=!1}finally{u?U(i):X(i)}return se(i,n),ie(s,i)}else if(!t||typeof t!="object"){if(s=r(t),s===void 0&&(s=t),s===oe&&(s=void 0),this.autoFreeze_&&Z(s,!0),n){const i=[],o=[];v("Patches").generateReplacementPatches_(t,s,i,o),n(i,o)}return s}else _(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...u)=>this.produceWithPatches(o,f=>t(f,...u));let n,s;return[this.produce(t,r,(o,u)=>{n=o,s=u}),n,s]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){b(e)||_(8),N(e)&&(e=We(e));const t=ce(this),r=Y(e,void 0);return r[h].isManual_=!0,X(t),r}finishDraft(e,t){const r=e&&e[h];(!r||!r.isManual_)&&_(9);const{scope_:n}=r;return se(n,t),ie(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const s=t[r];if(s.path.length===0&&s.op==="replace"){e=s.value;break}}r>-1&&(t=t.slice(r+1));const n=v("Patches").applyPatches_;return N(e)?n(e,t):this.produce(e,s=>n(s,t))}};function Y(e,t){const r=D(e)?v("MapSet").proxyMap_(e,t):M(e)?v("MapSet").proxySet_(e,t):Ke(e,t);return(t?t.scope_:de()).drafts_.push(r),r}function We(e){return N(e)||_(10,e),he(e)}function he(e){if(!b(e)||B(e))return e;const t=e[h];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=H(e,t.scope_.immer_.useStrictShallowCopy_)}else r=H(e,!0);return S(r,(n,s)=>{ue(r,n,he(s))}),t&&(t.finalized_=!1),r}var m=new Qe,W=m.produce;m.produceWithPatches.bind(m);m.setAutoFreeze.bind(m);m.setUseStrictShallowCopy.bind(m);m.applyPatches.bind(m);m.createDraft.bind(m);m.finishDraft.bind(m);function Ge(e,t,r,n){for(var s=-1,i=e==null?0:e.length;++s<i;){var o=e[s];t(n,o,r(o),e)}return n}var He=Ge;function Ue(e){return function(t,r,n){for(var s=-1,i=Object(t),o=n(t),u=o.length;u--;){var f=o[e?u:++s];if(r(i[f],f,i)===!1)break}return t}}var Xe=Ue,Je=Xe,Ye=Je(),Ze=Ye,Ve=Ze,et=je;function tt(e,t){return e&&Ve(e,t,et)}var rt=tt,nt=Ne;function st(e,t){return function(r,n){if(r==null)return r;if(!nt(r))return e(r,n);for(var s=r.length,i=t?s:-1,o=Object(r);(t?i--:++i<s)&&n(o[i],i,o)!==!1;);return r}}var ct=st,it=rt,at=ct,ot=at(it),lt=ot,ut=lt;function dt(e,t,r,n){return ut(e,function(s,i,o){t(n,s,r(s),o)}),n}var ft=dt,ht=He,mt=ft,_t=Pe,yt=we;function pt(e,t){return function(r,n){var s=yt(r)?ht:mt,i=t?t():{};return s(r,e,_t(n),i)}}var xt=pt,gt=Ae,bt=xt,vt=bt(function(e,t,r){gt(e,r,t)}),jt=vt;const Nt=ke(jt);function Ft(){var ee;const{extendedPurchases:e,setExtendedPurchases:t}=x.useContext(Fe),{data:r,refetch:n}=Ce({queryKey:["purchases",{status:re.inCart}],queryFn:()=>C.getPurchases({status:re.inCart})}),s=R({mutationFn:C.updatePurchase,onSuccess:()=>{n()}}),i=R({mutationFn:C.buyProducts,onSuccess:a=>{n(),Ee.success(a.data.message,{position:"top-center",autoClose:1e3})}}),o=R({mutationFn:C.deletePurchase,onSuccess:()=>{n()}}),f=(ee=Se().state)==null?void 0:ee.purchaseId,p=r==null?void 0:r.data.data,P=x.useMemo(()=>e.every(a=>a.checked),[e]),y=x.useMemo(()=>e.filter(a=>a.checked),[e]),me=y.length,_e=x.useMemo(()=>y.reduce((a,l)=>a+l.product.price*l.buy_count,0),[y]),ye=x.useMemo(()=>y.reduce((a,l)=>a+(l.product.price_before_discount-l.product.price)*l.buy_count,0),[y]);x.useEffect(()=>{t(a=>{const l=Nt(a,"_id");return(p==null?void 0:p.map(d=>{var A;const I=f===d._id;return{...d,disabled:!1,checked:I||!!((A=l[d._id])!=null&&A.checked)}}))||[]})},[p,f]),x.useEffect(()=>{history.replaceState(null,"")},[]);const pe=a=>l=>{t(W(d=>{d[a].checked=l.target.checked}))},T=()=>{t(a=>a.map(l=>({...l,checked:!P})))},xe=a=>l=>{t(W(d=>{d[a].buy_count=l}))},$=(a,l,d)=>{if(d){const I=e[a];t(W(A=>{A[a].disabled=!0})),s.mutate({product_id:I.product._id,buy_count:l})}},ge=a=>()=>{const l=e[a]._id;o.mutate([l])},be=()=>{const a=y.map(l=>l._id);o.mutate(a)},ve=()=>{if(y.length>0){const a=y.map(l=>({product_id:l.product._id,buy_count:l.buy_count}));i.mutate(a)}};return c.jsxs("div",{className:"bg-neutral-100 py-16",children:[c.jsxs(ze,{children:[c.jsx("title",{children:"Giỏ hàng | Shopee Clone"}),c.jsx("meta",{name:"description",content:"Trang giỏ hàng dự án Shopee Clone"})]}),c.jsx("div",{className:"container",children:e.length>0?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"overflow-auto",children:c.jsxs("div",{className:"min-w-[1000px]",children:[c.jsxs("div",{className:"grid grid-cols-12 rounded-sm bg-white px-5 py-9 text-sm capitalize text-gray-500 shadow",children:[c.jsx("div",{className:"col-span-6",children:c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex flex-shrink-0 pr-3 items-center justify-center",children:c.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:P,onChange:T})}),c.jsx("div",{className:"flex-grow text-black",children:"Sản phẩm"})]})}),c.jsx("div",{className:"col-span-6",children:c.jsxs("div",{className:"grid grid-cols-5 text-center",children:[c.jsx("div",{className:"col-span-2",children:"Đơn giá"}),c.jsx("div",{className:"col-span-1",children:"Số lượng"}),c.jsx("div",{className:"col-span-1",children:"Thành tiền"}),c.jsx("div",{className:"col-span-1",children:"Thao tác"})]})})]}),c.jsx("div",{className:"my-3 rounded-sm bg-white p-3 shadow",children:e==null?void 0:e.map((a,l)=>c.jsxs("div",{className:"mb-5 grid grid-cols-12 rounded-sm items-center border border-gray-200 bg-white py-5 px-4 text-sm text-gray-500 text-center first:mt-0",children:[c.jsx("div",{className:"col-span-6",children:c.jsxs("div",{className:"flex",children:[c.jsx("div",{className:"flex flex-shrink-0 justify-center items-center pr-3",children:c.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:a.checked,onChange:pe(l)})}),c.jsx("div",{className:"flex flex-grow",children:c.jsxs("div",{className:"flex",children:[c.jsx(q,{to:`${K.home}${te({name:a.product.name,id:a.product._id})}`,className:"h-20 w-20 flex-shrink-0",children:c.jsx("img",{src:a.product.image,alt:""})}),c.jsx("div",{className:"flex-grow px-2 pt-1 pb-2",children:c.jsx(q,{to:`${K.home}${te({name:a.product.name,id:a.product._id})}`,className:"text-left line-clamp-2",children:a.product.name})})]})})]})}),c.jsx("div",{className:"col-span-6",children:c.jsxs("div",{className:"grid grid-cols-5 items-center",children:[c.jsx("div",{className:"col-span-2",children:c.jsx("div",{className:"flex items-center justify-center",children:c.jsxs("span",{className:"text-gray-300 line-through",children:["₫",F(a.product.price_before_discount)]})})}),c.jsx("div",{className:"col-span-1",children:c.jsx(De,{max:a.product.quantity,value:a.buy_count,classNameWrapper:"flex items-center",onIncrease:d=>$(l,d,d<=a.product.quantity),onDecrease:d=>$(l,d,d>=1),onType:xe(l),onFocusOut:d=>$(l,d,d>=1&&d<=a.product.quantity&&d!==p[l].buy_count),disabled:a.disabled})}),c.jsx("div",{className:"col-span-1",children:c.jsxs("span",{className:"text-orange",children:["₫",F(a.product.price*a.buy_count)]})}),c.jsx("div",{className:"col-span-1",children:c.jsx("button",{onClick:ge(l),className:"bg-none text-black transition-colors hover:text-orange",children:"Xoá"})})]})})]},a._id))})]})}),c.jsxs("div",{className:"sticky bottom-0 z-10 mt-8 flex flex-col rounded-sm border border-gray-100 bg-white p-5 shadow sm:flex-row sm:items-center",children:[c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:c.jsx("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:P,onChange:T})}),c.jsxs("button",{className:"mx-3 border-none bg-none",onClick:T,children:["Chọn tất cả (",e.length,")"]}),c.jsx("button",{onClick:be,className:"mx-3 border-none bg-none",children:"Xóa"})]}),c.jsxs("div",{className:"mt-5 flex flex-col sm:ml-auto sm:mt-0 sm:flex-row sm:items-center",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center sm:justify-end",children:[c.jsxs("div",{children:["Tổng thanh toán (",me," sản phẩm):"]}),c.jsxs("div",{className:"ml-2 text-2xl text-orange",children:["₫",F(_e)]})]}),c.jsxs("div",{className:"flex items-center text-sm sm:justify-end",children:[c.jsx("div",{className:"text-gray-500",children:"Tiết kiệm"}),c.jsxs("div",{className:"ml-6 text-orange",children:["₫",F(ye)]})]})]}),c.jsx(Me,{onClick:ve,disabled:i.isPending,className:"mt-5 flex h-10 w-52 items-center justify-center bg-red-500 text-sm uppercase text-white hover:bg-red-600 sm:ml-4 sm:mt-0",children:"Mua hàng"})]})]})]}):c.jsxs("div",{className:"text-center",children:[c.jsx("img",{src:Oe,alt:"no purchase",className:"mx-auto h-24 w-24"}),c.jsx("div",{className:"mt-5 font-bold text-gray-400",children:"Giỏ hàng của bạn còn trống"}),c.jsx("div",{className:"mt-5 text-center",children:c.jsx(q,{to:K.home,className:" rounded-sm bg-orange px-10 py-2  uppercase text-white transition-all hover:bg-orange/80",children:"Mua ngay"})})]})})]})}export{Ft as default};
